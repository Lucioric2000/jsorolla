<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Circos Browser</title>
    <!-- Node modules -->
    <script type="text/javascript" src="../../../node_modules/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="../../../node_modules/backbone/backbone-min.js"></script>
    <!-- Core libs -->
    <script type="text/javascript" src="../../core/utilsNew.js"></script>
    <script type="text/javascript" src="../../core/svg.js"></script>
    <script type="text/javascript" src="../../core/cellbase-manager.js"></script>
    <script type="text/javascript" src="../../core/clients/rest-client.js"></script>
    <script type="text/javascript" src="../../core/clients/cellbase-client.js"></script>
    <script type="text/javascript" src="../../core/data-adapter/feature-adapter.js"></script>
    <script type="text/javascript" src="../../core/data-adapter/cellbase-adapter.js"></script>
    <!-- Circos module -->
    <script type="text/javascript" src="../circos-utils.js"></script>
    <script type="text/javascript" src="../circos-browser.js"></script>
    <script type="text/javascript" src="../circos-layout.js"></script>
    <!-- Circos Tracks -->
    <script type="text/javascript" src="../tracks/track.js"></script>
    <script type="text/javascript" src="../tracks/karyotype.js"></script>
    <script type="text/javascript" src="../tracks/histogram.js"></script>
    <script type="text/javascript" src="../tracks/chords.js"></script>
    <!-- Circos renderers -->
    <script type="text/javascript" src="../renderers/renderer.js"></script>
    <script type="text/javascript" src="../renderers/karyotype.js"></script>
    <script type="text/javascript" src="../renderers/histogram.js"></script>
    <script type="text/javascript" src="../renderers/chords.js"></script>
    <!-- Test scripts -->
    <script type="text/javascript" src="../circos-test.js"></script>
</head>
<body>
    <h2>Circos Browser</h2>
    <div id="circos" align="center"></div>
    <script type="text/javascript">
        let circos = null;
        //Function to get the raw chromosomes data
        let getChromosomesData = function () {
            return Object.values(circos.layout.blocks).map(function (block) {
                return block.data;
            });
        };
        //Karyotype track configuration
        let karyotypeTrack = new CircosKaryotypeTrack({}, {
            "size": 15,
            "rank": 1
        });
        //Histogram track configuration
        let histogramTrack = new CircosHistogramTrack({
            "dataAdapter": {
                "getData": function () {
                    return new Promise(function (resolve, reject) {
                        return resolve(CircosTest.buildHistogramData(getChromosomesData()));
                    });
                }
            }
        }, {
            "size": 30,
            "rank": 2
        });
        //Chords track configuration
        let chordsTrack = new CircosChordsTrack({
            "dataAdapter": {
                "getData": function () {
                    return new Promise(function (resolve, reject) {
                       return resolve(CircosTest.buildChordsData(getChromosomesData()));
                    });
                }
            }
        }, {
            "size": 130,
            "rank": 0
        });
        //Build the circos
        circos = new CircosBrowser(document.getElementById("circos"), {
            "tracks": [karyotypeTrack, histogramTrack, chordsTrack],
            "layout": new CircosLayout({
                "dataParser": function (data) {
                    CircosUtils.sortChromosomes(data);
                    return data;
                }
            }, {})
        }, {
            "trackOffset": 0
        });
        //Draw the circos
        circos.draw();
    </script>
</body>

